<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="[tech blog 읽기] CDC 너두 할 수 있어(feat. B2B 알림 서비스에 Kafka CDC 적용하기) # B2B 알림 서비스에 CDC를 도입을 하게 되었다.
B2B 알림 서비스 # B2B 알림 서비스 프로젝트가 무엇일까? 배민 B2C 고객 서비스에서는 알림센터라는 시스템을 통해 고객에 알림을 발송한다. 하지만, 사장님에게 발송되는 알림은 플랫폼이 부재한 관계로 카카오 알림톡으로 발송하고 있었다. 개선을 위해 알림센터를 활용해 사장님에게 전달되는 메시지를 내부 서비스를 통해 전달함으로써, 내부 서비스 활용도와 사용자 편의성을 향상시키고자 진행한 프로젝트가 &lsquo;B2B 알림서비스&rsquo;다.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="[tech blog 읽기] CDC 너두 할 수 있어(feat. B2B 알림 서비스에 Kafka CDC 적용하기) # B2B 알림 서비스에 CDC를 도입을 하게 되었다.
B2B 알림 서비스 # B2B 알림 서비스 프로젝트가 무엇일까? 배민 B2C 고객 서비스에서는 알림센터라는 시스템을 통해 고객에 알림을 발송한다. 하지만, 사장님에게 발송되는 알림은 플랫폼이 부재한 관계로 카카오 알림톡으로 발송하고 있었다. 개선을 위해 알림센터를 활용해 사장님에게 전달되는 메시지를 내부 서비스를 통해 전달함으로써, 내부 서비스 활용도와 사용자 편의성을 향상시키고자 진행한 프로젝트가 &lsquo;B2B 알림서비스&rsquo;다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/docs/kafka/001_kafka_cdc/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2023-12-11T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-11T22:22:08+09:00" />

<title>001 Kafka Cdc | TIL</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="stylesheet" href="/book.min.4f0117e74e5337280f18eb9641eae520cb4b25adcf5dd64fafad4664145a5957.css" integrity="sha256-TwEX505TNygPGOuWQerlIMtLJa3PXdZPr61GZBRaWVc=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.2de369ba04e0de082a8955d861e2d4c7eb20fa9fe5a73bca919e26d9116d7561.js" integrity="sha256-LeNpugTg3ggqiVXYYeLUx&#43;sg&#43;p/lpzvKkZ4m2RFtdWE=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>TIL</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-353f7a5578fa41dbc42c73ea30fe2255" class="toggle"  />
    <label for="section-353f7a5578fa41dbc42c73ea30fe2255" class="flex justify-between">
      <a href="/docs/algorithm/" class="">Algorithm</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-92d85911959de2466ef66b3821f607d7" class="toggle"  />
    <label for="section-92d85911959de2466ef66b3821f607d7" class="flex justify-between">
      <a href="/docs/batch/" class="">Batch</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/batch/001_performance_improved_batch/" class="">001 Performance Improved Batch</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3fd9018456329c22500501d97c791fad" class="toggle"  />
    <label for="section-3fd9018456329c22500501d97c791fad" class="flex justify-between">
      <a href="/docs/data-structure/" class="">Data Structure</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f63d6cf864a4b2a00c9bc1b7f8921b37" class="toggle"  />
    <label for="section-f63d6cf864a4b2a00c9bc1b7f8921b37" class="flex justify-between">
      <a href="/docs/ddd/" class="">Ddd</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-10d41b0387e5bda7e9958b9b5ece051e" class="toggle"  />
    <label for="section-10d41b0387e5bda7e9958b9b5ece051e" class="flex justify-between">
      <a href="/docs/docker/" class="">Docker</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ba0b1465c1bad5a998860ad5f870bf7e" class="toggle"  />
    <label for="section-ba0b1465c1bad5a998860ad5f870bf7e" class="flex justify-between">
      <a href="/docs/etc/" class="">Etc</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-eca69da21de5b0cd25d8421dec09a327" class="toggle"  />
    <label for="section-eca69da21de5b0cd25d8421dec09a327" class="flex justify-between">
      <a href="/docs/java/" class="">Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/java/001_facade_pattern/" class="">001 Facade Pattern</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f3c1d22d19edbcf158d04b84a4d9d6c2" class="toggle"  />
    <label for="section-f3c1d22d19edbcf158d04b84a4d9d6c2" class="flex justify-between">
      <a href="/docs/jenkins/" class="">Jenkins</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-55218fb7ef47d61aa86fc77253026243" class="toggle"  />
    <label for="section-55218fb7ef47d61aa86fc77253026243" class="flex justify-between">
      <a href="/docs/jpa/" class="">Jpa</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c03dced0c5b16cbce767a51b81ce1077" class="toggle" checked />
    <label for="section-c03dced0c5b16cbce767a51b81ce1077" class="flex justify-between">
      <a href="/docs/kafka/" class="">Kafka</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/001_kafka_cdc/" class="active">001 Kafka Cdc</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-04d541b0249994115320e926dbc9d6c5" class="toggle"  />
    <label for="section-04d541b0249994115320e926dbc9d6c5" class="flex justify-between">
      <a href="/docs/kotlin/" class="">Kotlin</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/005_Kotlin_extractList_Method/" class="">005 Kotlin Extract List Method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/004_Kotlin_Scoping_Functions/" class="">004 Kotlin Scoping Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/003_Kotlin_basic/" class="">003 Kotlin Basic</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/002_Functional_Programming_Example/" class="">002 Functional Programming Example</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/001_Functional_Programming/" class="">001 Functional Programming</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6ae1a891fb3a3f71d71273fc61b29b76" class="toggle"  />
    <label for="section-6ae1a891fb3a3f71d71273fc61b29b76" class="flex justify-between">
      <a href="/docs/linux/" class="">Linux</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b16ff4658c272fcaa2c58683b4c10070" class="toggle"  />
    <label for="section-b16ff4658c272fcaa2c58683b4c10070" class="flex justify-between">
      <a href="/docs/mongodb/" class="">Mongodb</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/003_spring_data_mongodb/" class="">003 Spring Data Mongodb</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/004_object_mapping/" class="">004 Object Mapping</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/005_mongoOperations/" class="">005 Mongo Operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/006_reactiveMongoRepository/" class="">006 Reactive Mongo Repository</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/007_query_method/" class="">007 Query Method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/001_reactive_mongodb/" class="">001 Reactive Mongodb</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/002_mongodb_document/" class="">002 Mongodb Document</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5e9a5c8a0cadf7504bcc8a3083d0b6fb" class="toggle"  />
    <label for="section-5e9a5c8a0cadf7504bcc8a3083d0b6fb" class="flex justify-between">
      <a href="/docs/msa/" class="">Msa</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/msa/003_circuit_breaker/" class="">003 Circuit Breaker</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/msa/001_reactive/" class="">001 Reactive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/msa/002_reactive_microservice/" class="">002 Reactive Microservice</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6d933f523f0d56e111956755e38e3f44" class="toggle"  />
    <label for="section-6d933f523f0d56e111956755e38e3f44" class="flex justify-between">
      <a href="/docs/mvc/" class="">Mvc</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e66e2e478c81786f553bd82d3931b216" class="toggle"  />
    <label for="section-e66e2e478c81786f553bd82d3931b216" class="flex justify-between">
      <a href="/docs/mysql/" class="">Mysql</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3110560962cac834dcd3aead95e804a4" class="toggle"  />
    <label for="section-3110560962cac834dcd3aead95e804a4" class="flex justify-between">
      <a href="/docs/network/" class="">Network</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-83cd0ab2c9840783352e3b96d8e79d5c" class="toggle"  />
    <label for="section-83cd0ab2c9840783352e3b96d8e79d5c" class="flex justify-between">
      <a href="/docs/operating-system/" class="">Operating System</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bf2e8ecdf9011d9f48a2a3a2c2d46bd1" class="toggle"  />
    <label for="section-bf2e8ecdf9011d9f48a2a3a2c2d46bd1" class="flex justify-between">
      <a href="/docs/oracle/" class="">Oracle</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-708c7a6270d696606cabeb20f951886f" class="toggle"  />
    <label for="section-708c7a6270d696606cabeb20f951886f" class="flex justify-between">
      <a href="/docs/r2dbc/" class="">R2dbc</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/005_r2dbc_Metadata_mapping/" class="">005 R2dbc Metadata Mapping</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/006_r2dbcEntityOperations/" class="">006 R2dbc Entity Operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/007_r2dbcRepository/" class="">007 R2dbc Repository</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/008_r2dbc_query_method/" class="">008 R2dbc Query Method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/003_r2dbcEntityTemplate/" class="">003 R2dbc Entity Template</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/004_r2dbc_object_mapping/" class="">004 R2dbc Object Mapping</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/002_r2dbc_mysql/" class="">002 R2dbc Mysql</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/001_r2dbc_intro/" class="">001 R2dbc Intro</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0a72c474e6931ed755713a00cb7d19a4" class="toggle"  />
    <label for="section-0a72c474e6931ed755713a00cb7d19a4" class="flex justify-between">
      <a href="/docs/reactive-streams/" class="">Reactive Streams</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive-streams/002_impl1_reactor/" class="">002 Impl1 Reactor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive-streams/003_impl2_rxjava/" class="">003 Impl2 Rxjava</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive-streams/004_impl3_munity/" class="">004 Impl3 Munity</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive-streams/001_reactive_streams_component/" class="">001 Reactive Streams Component</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a27d7ef673b519721b4909eba7547282" class="toggle"  />
    <label for="section-a27d7ef673b519721b4909eba7547282" class="flex justify-between">
      <a href="/docs/redis/" class="">Redis</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/003_reactive_redis_intro/" class="">003 Reactive Redis Intro</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/004_Lettuce/" class="">004 Lettuce</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/005_ReactiveRedisTemplate/" class="">005 Reactive Redis Template</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/006_ReactiveOperations/" class="">006 Reactive Operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/001_redis_datastructure/" class="">001 Redis Datastructure</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/002_redis_cache/" class="">002 Redis Cache</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6ce8ef21c020ccdb7ed73156795b30be" class="toggle"  />
    <label for="section-6ce8ef21c020ccdb7ed73156795b30be" class="flex justify-between">
      <a href="/docs/security/" class="">Security</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-4442d34d5ae489970dcda30dcfc7289e" class="toggle"  />
    <label for="section-4442d34d5ae489970dcda30dcfc7289e" class="flex justify-between">
      <a href="/docs/servlet/" class="">Servlet</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-12bece9beab0746d531536027bb6a777" class="toggle"  />
    <label for="section-12bece9beab0746d531536027bb6a777" class="flex justify-between">
      <a href="/docs/spring/" class="">Spring</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5f1e4c3c9f29fee9a25ac2c5291c7472" class="toggle"  />
    <label for="section-5f1e4c3c9f29fee9a25ac2c5291c7472" class="flex justify-between">
      <a href="/docs/webflux/" class="">Webflux</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Categories and tags
      </a>
  </li>
  
  <li>
    <a href="https://github.com/seohaebada"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://devfunny.tistory.com"  target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>001 Kafka Cdc</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#tech-blog-읽기-cdc-너두-할-수-있어feat-b2b-알림-서비스에-kafka-cdc-적용하기">[tech blog 읽기] CDC 너두 할 수 있어(feat. B2B 알림 서비스에 Kafka CDC 적용하기)</a>
      <ul>
        <li><a href="#b2b-알림-서비스">B2B 알림 서비스</a></li>
        <li><a href="#b2b-알림서비스에-cdc를-도입하게-된-이유">B2B 알림서비스에 CDC를 도입하게 된 이유</a></li>
        <li><a href="#cdc-change-data-capture">CDC (Change Data Capture)</a></li>
        <li><a href="#kafka-cdc를-활용-방법">Kafka CDC를 활용 방법</a></li>
        <li><a href="#주의할점">주의할점</a></li>
        <li><a href="#정리">정리</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="tech-blog-읽기-cdc-너두-할-수-있어feat-b2b-알림-서비스에-kafka-cdc-적용하기">
  [tech blog 읽기] CDC 너두 할 수 있어(feat. B2B 알림 서비스에 Kafka CDC 적용하기)
  <a class="anchor" href="#tech-blog-%ec%9d%bd%ea%b8%b0-cdc-%eb%84%88%eb%91%90-%ed%95%a0-%ec%88%98-%ec%9e%88%ec%96%b4feat-b2b-%ec%95%8c%eb%a6%bc-%ec%84%9c%eb%b9%84%ec%8a%a4%ec%97%90-kafka-cdc-%ec%a0%81%ec%9a%a9%ed%95%98%ea%b8%b0">#</a>
</h1>
<p>B2B 알림 서비스에 CDC를 도입을 하게 되었다.</p>
<h2 id="b2b-알림-서비스">
  B2B 알림 서비스
  <a class="anchor" href="#b2b-%ec%95%8c%eb%a6%bc-%ec%84%9c%eb%b9%84%ec%8a%a4">#</a>
</h2>
<p>B2B 알림 서비스 프로젝트가 무엇일까?
배민 B2C 고객 서비스에서는 알림센터라는 시스템을 통해 고객에 알림을 발송한다.
하지만, 사장님에게 발송되는 알림은 플랫폼이 부재한 관계로 카카오 알림톡으로 발송하고 있었다.
개선을 위해 알림센터를 활용해 사장님에게 전달되는 메시지를 내부 서비스를 통해 전달함으로써,
내부 서비스 활용도와 사용자 편의성을 향상시키고자 진행한 프로젝트가 &lsquo;B2B 알림서비스&rsquo;다.
여기서, <code>세일즈 매니저에 대한 알림톡을 알림센터 내 웹 푸시 알림으로 전환</code> 하는 과정에서 CDC를 도입하게되었다.

  <img src="/image/kafka/001/img.png" alt="img.png" /></p>
<h2 id="b2b-알림서비스에-cdc를-도입하게-된-이유">
  B2B 알림서비스에 CDC를 도입하게 된 이유
  <a class="anchor" href="#b2b-%ec%95%8c%eb%a6%bc%ec%84%9c%eb%b9%84%ec%8a%a4%ec%97%90-cdc%eb%a5%bc-%eb%8f%84%ec%9e%85%ed%95%98%ea%b2%8c-%eb%90%9c-%ec%9d%b4%ec%9c%a0">#</a>
</h2>
<p>세일즈 매니저에게 알림이 발송되는 경우</p>
<ol>
<li>세일즈 매니저 본인이 만든 업무 요청 건의 상태가 변경되는 경우</li>
<li>세일즈 매니저 본인이 해당 가게의 세일즈 매니저로 설정되어있는 업무 요청 건의 상태가 변경될 경우</li>
</ol>
<p>기존에 알림 발송은 프론트 코드에 있던 상태였지만, 아래와 같은 문제 존재</p>
<ol>
<li>네트워크 문제로 알림 발송 누락</li>
<li>알림 발송 이후 요청 건의 상태 변경에 실패하면 실제 데이터와 맞지 않음
위와 같은 사유로 백엔드에서 처리를 해야했다.
그래서 요청 건의 상태가 변경되면 DB에 반영되는 것에 착안하여 변경된 데이터를 감지하는 CDC를 선택하게되었다.</li>
</ol>
<h2 id="cdc-change-data-capture">
  CDC (Change Data Capture)
  <a class="anchor" href="#cdc-change-data-capture">#</a>
</h2>
<p>소스 시스템에서 데이터가 변경된 것을 감지하여, 타깃 시스템이 변경 작업에 대응하는 작업을 수행하도록 하는 프로세스</p>
<ul>
<li>소스 시스템 : DB</li>
<li>타깃 시스템 : B2B 알림 서비스
CDC를 활용하면 데이터를 사용하는 모든 시스템에서 일관성을 유지할 수 있다는 장점이 있다.</li>
</ul>
<ol>
<li>
<p>pull 방식
타깃 시스템의 주기적인 풀링으로 변경 사항이 있는지 확인
실시간성이 떨어진다.
구현은 쉽다.</p>
</li>
<li>
<p>push 방식
소스 시스템이 변경될때마다 타깃 시스템에 알려준다.
pull 방식에 비해 소스 시스템이 많은 작업을 해야하고, 타깃 시스템에 문제가 발생하면 변경 이벤트에 누락이 발생할 수 있다.
실시간성이 뛰어나다.</p>
</li>
</ol>
<blockquote>
<p>Kafka CDC</p>
</blockquote>
<ul>
<li>위 방식 중에 <code>Push 방식</code>에서 이벤트 누락의 단점을 메시지 큐인 Kafka를 통해 해결하여, CDC 시스템을 만드는 것</li>
</ul>
<blockquote>
<p>Debezium MySQL Connector</p>
</blockquote>
<ul>
<li>DB로부터 데이터의 변경 이벤트를 감지해서 Kafka 이벤트를 발행해주는 것</li>
<li>Mysql의 binlog를 읽어 INSERT, UPDATE, DELETE 연산에 대한 변경 이벤트를 만들어 KAfka 토픽으로 이벤트를 전송</li>
<li>binlog를 기반으로 데이터를 수집하기 때문에, DB에서 수행된 모든 이벤트가 안정적으로 수집되고, 이벤트 발행시 정확한 순서 보장</li>
</ul>
<h2 id="kafka-cdc를-활용-방법">
  Kafka CDC를 활용 방법
  <a class="anchor" href="#kafka-cdc%eb%a5%bc-%ed%99%9c%ec%9a%a9-%eb%b0%a9%eb%b2%95">#</a>
</h2>
<ol>
<li>사전준비</li>
</ol>
<ul>
<li>Kafka</li>
<li>Kafka Connect</li>
<li>Debezium MySQL Connector</li>
</ul>
<ol start="2">
<li>Kafka CDC를 활용한 코드 작성하기</li>
</ol>
<ul>
<li>Kafka를 통해 넘어오는 이벤트 레코드를 변환해야 하는데, Debezium MySQL Connector는 Apache Avro를 지원한다.</li>
<li>이를 사용하려면 스키마 레지스트리를 사용해야한다.</li>
<li>스키마 레지스트리에 등록된 스키마를 받기 위해서, 프로젝트의 gradle에 설정을 추가해두면 편하다.</li>
</ul>
<pre tabindex="0"><code>val schemaRegistry = &#34;http://localhost:8081&#34; // 스키마 레지스트리 주소
val downloadInputs = listOf(
    &#34;schema.data-key&#34;,
    &#34;schema.data-value&#34;
)
val avroDestination = &#34;org/main/avro&#34; //avro 스키마가 저장될 프로젝트상의 위치
schemaRegistry {
    url.set(schemaRegistry)
    download {
        // 패턴에 해당하는 서브젝트(스키마)를 다운로드
        downloadInputs.forEach {
            subjectPattern(
                inputPattern = it,
                file = avroDestination
            )
        }
    }
}
</code></pre><ul>
<li>arvo 스키마</li>
</ul>
<pre tabindex="0"><code>{
    &#34;type&#34;: &#34;record&#34;,
    &#34;name&#34;: &#34;Envelope&#34;,
    &#34;namespace&#34;: &#34;schema.data&#34;,
    &#34;fields&#34;: [
        {
            &#34;name&#34;: &#34;before&#34;,
            &#34;type&#34;: [
                &#34;null&#34;,
                {
                    &#34;type&#34;: &#34;record&#34;,
                    &#34;name&#34;: &#34;Value&#34;,
                    &#34;fields&#34;: [
                        {
                            &#34;name&#34;: &#34;id&#34;,
                            &#34;type&#34;: &#34;long&#34;
                        }
                        // ...
                    ],
                    &#34;connect.name&#34;: &#34;schema.data&#34;
                }
            ],
            &#34;default&#34;: null
        },
        {
            &#34;name&#34;: &#34;after&#34;,
            &#34;type&#34;: [
                &#34;null&#34;,
                &#34;Value&#34;
            ],
            &#34;default&#34;: null
        },
        {
            &#34;name&#34;: &#34;source&#34;,
            &#34;type&#34;: {
                &#34;type&#34;: &#34;record&#34;,
                &#34;name&#34;: &#34;Source&#34;,
                &#34;namespace&#34;: &#34;io.debezium.connector.mysql&#34;,
                &#34;fields&#34;: [
                    {
                        &#34;name&#34;: &#34;version&#34;,
                        &#34;type&#34;: &#34;string&#34;
                    }
                    // ...
                ],
                &#34;connect.name&#34;: &#34;io.debezium.connector.mysql.Source&#34;
            }
        },
        {
            &#34;name&#34;: &#34;op&#34;,
            &#34;type&#34;: &#34;string&#34;
        },
        {
            &#34;name&#34;: &#34;ts_ms&#34;,
            &#34;type&#34;: [
                &#34;null&#34;,
                &#34;long&#34;
            ],
            &#34;default&#34;: null
        },
        {
            &#34;name&#34;: &#34;transaction&#34;,
            &#34;type&#34;: [
                &#34;null&#34;,
                {
                    &#34;type&#34;: &#34;record&#34;,
                    &#34;name&#34;: &#34;ConnectDefault&#34;,
                    &#34;namespace&#34;: &#34;io.confluent.connect.avro&#34;,
                    &#34;fields&#34;: [
                        {
                            &#34;name&#34;: &#34;id&#34;,
                            &#34;type&#34;: &#34;string&#34;
                        },
                        {
                            &#34;name&#34;: &#34;total_order&#34;,
                            &#34;type&#34;: &#34;long&#34;
                        },
                        {
                            &#34;name&#34;: &#34;data_collection_order&#34;,
                            &#34;type&#34;: &#34;long&#34;
                        }
                    ]
                }
            ],
            &#34;default&#34;: null
        }
    ],
    &#34;connect.name&#34;: &#34;schema.Envelope&#34;
}
</code></pre><ul>
<li>빌드 후 생성되는 클래스</li>
</ul>
<pre tabindex="0"><code>fun Envelop.toBefore(): CdcRecord? {
    val before = this.getBefore() ?: return null

    return CdcRecord(
        //...
    )
}
</code></pre><ul>
<li>ConsumerConfig 설정</li>
</ul>
<pre tabindex="0"><code>@Configuration
class CdcConsumerConfig {
    @Bean(CDC_CONTAINER_FACTORY)
    fun cdcListenerContainerFactory(
        properties: CdcConsumerProperties,
        @Value(&#34;\${spring.kafka.bootstrap-servers}&#34;) bootstrapServers: String
    ): KafkaListenerContainerFactory&lt;ConcurrentMessageListenerContainer&lt;String, Envelope&gt;&gt; {
        val factory = ConcurrentKafkaListenerContainerFactory&lt;String, Envelope&gt;()
        factory.consumerFactory = DefaultKafkaConsumerFactory(
            mapOf(
                ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG to bootstrapServers,
                ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG to properties.keyDeserializerClass,
                ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG to properties.valueDeserializerClass,
                ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG to properties.enableAutoCommit,
                ConsumerConfig.MAX_POLL_RECORDS_CONFIG to properties.maxPollRecords,
                ConsumerConfig.AUTO_OFFSET_RESET_CONFIG to properties.autoOffsetReset,
                // Schema Registry, Avro 관련 설정 필수
                KafkaAvroDeserializerConfig.SCHEMA_REGISTRY_URL_CONFIG to properties.schemaRegistryUrl,
                KafkaAvroDeserializerConfig.SPECIFIC_AVRO_READER_CONFIG to properties.specificAvroReader,
            )
        )
        // ...
    }
}
</code></pre><ul>
<li>이벤트 리스너 생성</li>
</ul>
<pre tabindex="0"><code>class CdcEventListener(
    private val cdcEventProcessor: List&lt;CdcEventProcessor&gt;,
) {
    private val sinkQueue = Queues.get&lt;List&lt;Envelope&gt;&gt;(4096).get()
    private val sinks = Sinks.many()
        .unicast()
        .onBackpressureBuffer(sinkQueue)
    private lateinit var disposable: Disposable

    @KafkaListener(
        topics = [&#34;\${kafka.cdc.topic}&#34;],
        groupId = &#34;\${kafka.cdc.groupId}&#34;,
        containerFactory = CdcConsumerConfig.CDC_CONTAINER_FACTORY,
    )
    fun listen(
        @Payload payloads: List&lt;Envelope?&gt;,
        @Header(KafkaHeaders.RECEIVED_PARTITION_ID) partition: Int,
        @Header(KafkaHeaders.RECEIVED_TOPIC) topic: String,
        @Header(KafkaHeaders.RECEIVED_TIMESTAMP) ts: Long,
        acknowledgment: Acknowledgment,
    ) {
        // ... 
    }
}
</code></pre><blockquote>
<p>조건 : CDC 이벤트의 종류에 따라서 다른 알림을 보내야 한다.
서로 다른 이벤트의 종류를 받을 이벤트 프로세서 + 각 이벤트 내에서 어떤 알림을 보낼지 결정하는 이벤트 핸들러</p>
</blockquote>
<ul>
<li>
<p>요청 건에 대한 어떤 이벤트인가? : 가게 로고 수정, 가게 소개 수정 등</p>
</li>
<li>
<p>어떤 이벤트인가? : 요청이 승인됨, 요청이 반려됨 등

  <img src="/image/kafka/001/img_1.png" alt="img_1.png" /></p>
</li>
<li>
<p>각 이벤트 프로세서에 이벤트를 전달하는 코드</p>
</li>
</ul>
<pre tabindex="0"><code>class CdcEventListener(
    private val cdcEventProcessor: List&lt;CdcEventProcessor&gt;,
) {
    // ...
    @PostConstruct
    protected fun init() {
        disposable = sinks.asFlux()
            // ...
            // 이벤트를 처리 하는 과정에서 doAlarm으로 알림 발송
            .doOnNext(::doAlarm)
            // ...
    }

    private fun doAlarm(CdcRecords: List&lt;Envelope&gt; = emptyList()) {
        Flux.fromIterable(CdcRecords)
            .flatMap {
                Mono.fromCallable {
                    // 각각의 이벤트 프로세서에게 이벤트를 처리 하도록 지시
                    cdcEventProcessor.forEach { processor -&gt;
                        try {
                            processor.process(
                                before = it.toBefore(),
                                after = it.toAfter(),
                            )
                        } catch (e: Exception) {
                            log.warn(&#34;[CdcEventProcessor] occured exception&#34;, e)
                        }
                    }
                }.subscribeOn(Schedulers.boundedElastic())
            }.subscribe()
    }
}
</code></pre><ul>
<li>이벤트를 처리하는 이벤트 프로세서</li>
</ul>
<pre tabindex="0"><code>@Service
class NotificationCenterAlarmFacade(
    private val notificationHandlers: List&lt;NotificationHandler&gt;
) : CdcEventProcessor {

    override fun process(before: CdcRecord?, after: CdcRecord?) {
        log.debug(&#34;[알림서비스] process 진입 before = `{}`, after = `{}`&#34;, before, after)

        if (after == null) {
            log.info(&#34;[알림서비스] 데이터 삭제건에 대해서는 알림서비스 발송처리를 하지 않습니다. before: `{}`&#34;, before)
            return
        }

        notificationHandlers.find { it.accept(before = before, after = after) }
            ?.send(record = after)
    }
}
</code></pre><p>이벤트 프로세서에서는 자신이 전달받은 이벤트에 대해서 처리할 수 있는 이벤트인지 확인한 후,
처리할 수 있는 이벤트의 종류라면 자신이 가지고 있는 이벤트 핸들러들에게 처리를 위임한다.</p>
<ul>
<li>핸들러는 본인이 처리할 수 있는 이벤트인지 확인하고 알림을 보낸다. -&gt; B2B 알림 서비스 동작</li>
</ul>
<pre tabindex="0"><code>@Component
class CompleteHandler : NotificationHandler {
    override fun send(record: CdcRecord) {
        // 알림 발송 로직
    }

    override fun accept(before: CdcRecord?, after: CdcRecord?): Boolean {
        // 완료 이벤트에 대한 알림을 발송하는 핸들러이기 때문에, 완료 이벤트인지 확인하는 조건
        if (before == null || after == null ||
            before.status == Complete || after.status != Complete
        ) {
            return false
        }
        log.info(&#34;[알림서비스] 완료 이벤트 감지 `{}`&#34;, after.id)
        return true
    }
}
</code></pre><p>이제 특정 요청 건들의 상태가 변경되면 자동으로 알림을 받을 수 있다.</p>
<h2 id="주의할점">
  주의할점
  <a class="anchor" href="#%ec%a3%bc%ec%9d%98%ed%95%a0%ec%a0%90">#</a>
</h2>
<ol>
<li>
<p>AWS Aurora 환경에서 쓰기 부하가 많은 경우
Debezium MySQL Connector를 연동하면 binlog dump thread가 Aurora MySQL 클러스터 스토리지의 binlog를 읽는데, 이때 락을 건다.
Aurora MySQL 2.10.2 미만의 버전에서는 쓰기 부하가 많은 경우 부하가 심해질 수 있다.
binlog dump thread의 부하가 심해지는 경우 INSERT, UPDATE, DELETE, COMMIT 등 DML 관련 레이턴시가 증가하게 되고, 이에 따라 장애가 발생할 수 있다.</p>
</li>
<li>
<p>중복 메시지 발생의 가능성
여러 가지 경우로 Kakfa 메시지는 중복될 수 있다.</p>
</li>
</ol>
<blockquote>
<p>해결 방법 : Redis Cache</p>
</blockquote>
<pre tabindex="0"><code>class CdcEventListener(
    private val cdcEventProcessor: List&lt;CdcEventProcessor&gt;,
) {
    // ...
    @PostConstruct
    protected fun init() {
        disposable = sinks.asFlux()
            // ...
            // 이벤트를 처리 하는 과정에서 doCheckDuplicationPrevent 으로 중복 확인 
            .flatMap(::doCheckDuplicationPrevent)
            // ...
    }

    private fun doCheckDuplicationPrevent(cdcRecords: List&lt;Envelope&gt;): Mono&lt;List&lt;Envelope&gt;&gt; {
        return Mono.fromCallable {
            cdcRecords.filter {
                // HashCode를 이용한 RedisKey 생성
                val key = RedisCacheType.DUPLICATION_PREVENT.addPostfix(name = &#34;${it.getAfter().getId()}:${it.hashCode()}&#34;)
                // 해당 Key가 이미 존재하는지 확인
                val existKey = redisTemplate.opsForValue().existKey(
                    key = key
                )
                log.debug(
                    &#34;[CDC][EventEmitterSinks] Check Duplication Prevent. Key = `{}`, Value = `{}`&#34;,
                    key, existKey
                )
                (!existKey)
            }
        }.subscribeOn(Schedulers.boundedElastic())
    }
}
</code></pre><h2 id="정리">
  정리
  <a class="anchor" href="#%ec%a0%95%eb%a6%ac">#</a>
</h2>
<p>CDC 키워드로 보게된 기술 블로그 포스팅이였는데, CDC에 대한 감을 잡는데에 도움이 된것같다.
CDC, Kafka CDC, Debezium MySQL Connector 키워드에 대해서 좀더 공부해야할 필요를 느꼈다.</p>
<hr>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-References" id="tabs-References-0" checked="checked" />
  <label for="tabs-References-0">References</label>
  <div class="book-tabs-content markdown-inner">_1) 
  <a href="https://techblog.woowahan.com/10000/?ref=codenary">https://techblog.woowahan.com/10000/?ref=codenary</a></div></div>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/seohaebada/TIL/commit/0089f0b2f139d7182f9653729b07a5610d6f67d8" title='Last modified by seohaebada | December 11, 2023' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>December 11, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/seohaebada/TIL/content/docs/content/docs/kafka/001_kafka_cdc.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#tech-blog-읽기-cdc-너두-할-수-있어feat-b2b-알림-서비스에-kafka-cdc-적용하기">[tech blog 읽기] CDC 너두 할 수 있어(feat. B2B 알림 서비스에 Kafka CDC 적용하기)</a>
      <ul>
        <li><a href="#b2b-알림-서비스">B2B 알림 서비스</a></li>
        <li><a href="#b2b-알림서비스에-cdc를-도입하게-된-이유">B2B 알림서비스에 CDC를 도입하게 된 이유</a></li>
        <li><a href="#cdc-change-data-capture">CDC (Change Data Capture)</a></li>
        <li><a href="#kafka-cdc를-활용-방법">Kafka CDC를 활용 방법</a></li>
        <li><a href="#주의할점">주의할점</a></li>
        <li><a href="#정리">정리</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












