<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="tech blog 글 읽고 정리하기 # 누구나 할 수 있는 10배 더 빠른 배치 만들기 # 우아한형제들 셀러 시스템 배치 개선 이야기 # 우아한형제들 기술 블로그의 글을 읽으면서 정리해본다.
최근 셀러시스템팀에서 하루 한 번 주기로 실행되는 배치를 최적화하는 과제를 진행한 내용에 대한 포스팅이다.
비운영 시간 데이터 # 셀러시스템에서는 가게와 업주에 대한 다양한 데이터를 관리 사장님들의 관리 사항 &lsquo;가게가 운영하는지 안하는지&rsquo;에 대한 정보를 유관 부서에 전달한다. &lsquo;비운영시간 데이터&rsquo; 실시간으로 수정되는 정보를 반영 매일 새벽에 전체 데이터를 계산하고 그 결과를 미리 갱신해둔 후, 유관부서에 전파 다양한 채널에서 입력되는 각족 운영과 휴무 데이터를 취합해서 비운영시간 데이터를 계산 위 계산된 데이터가 클라이언트까지 잘 전달될 수 있도록 각 지면에 적절한 형태로 가공하여 제공 문제상황 # 새벽에 배치 작업을 할때, 수많은 가게의 데이터를 매일 갱신하므로 배치 수행시간이 오래걸린다.">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:title" content="" />
<meta property="og:description" content="tech blog 글 읽고 정리하기 # 누구나 할 수 있는 10배 더 빠른 배치 만들기 # 우아한형제들 셀러 시스템 배치 개선 이야기 # 우아한형제들 기술 블로그의 글을 읽으면서 정리해본다.
최근 셀러시스템팀에서 하루 한 번 주기로 실행되는 배치를 최적화하는 과제를 진행한 내용에 대한 포스팅이다.
비운영 시간 데이터 # 셀러시스템에서는 가게와 업주에 대한 다양한 데이터를 관리 사장님들의 관리 사항 &lsquo;가게가 운영하는지 안하는지&rsquo;에 대한 정보를 유관 부서에 전달한다. &lsquo;비운영시간 데이터&rsquo; 실시간으로 수정되는 정보를 반영 매일 새벽에 전체 데이터를 계산하고 그 결과를 미리 갱신해둔 후, 유관부서에 전파 다양한 채널에서 입력되는 각족 운영과 휴무 데이터를 취합해서 비운영시간 데이터를 계산 위 계산된 데이터가 클라이언트까지 잘 전달될 수 있도록 각 지면에 적절한 형태로 가공하여 제공 문제상황 # 새벽에 배치 작업을 할때, 수많은 가게의 데이터를 매일 갱신하므로 배치 수행시간이 오래걸린다." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://example.com/docs/batch/001_performance_improved_batch/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2023-12-09T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-27T20:53:20+09:00" />

<title>001 Performance Improved Batch | TIL</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" >
<link rel="stylesheet" href="/book.min.33a48f5432973b8ff9a82679d9e45d67f2c15d4399bd2829269455cfe390b5e8.css" integrity="sha256-M6SPVDKXO4/5qCZ52eRdZ/LBXUOZvSgpJpRVz&#43;OQteg=" crossorigin="anonymous">
  <script defer src="/flexsearch.min.js"></script>
  <script defer src="/en.search.min.09477b6f90d8f208c1d18bdeb8d7f2eb6aa41fc1324bdb3fe61154714fd059df.js" integrity="sha256-CUd7b5DY8gjB0YveuNfy62qkH8EyS9s/5hFUcU/QWd8=" crossorigin="anonymous"></script>

  <script defer src="/sw.min.6f6f90fcb8eb1c49ec389838e6b801d0de19430b8e516902f8d75c3c8bd98739.js" integrity="sha256-b2&#43;Q/LjrHEnsOJg45rgB0N4ZQwuOUWkC&#43;NdcPIvZhzk=" crossorigin="anonymous"></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>TIL</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>












  



  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-353f7a5578fa41dbc42c73ea30fe2255" class="toggle"  />
    <label for="section-353f7a5578fa41dbc42c73ea30fe2255" class="flex justify-between">
      <a href="/docs/algorithm/" class="">Algorithm</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-92d85911959de2466ef66b3821f607d7" class="toggle" checked />
    <label for="section-92d85911959de2466ef66b3821f607d7" class="flex justify-between">
      <a href="/docs/batch/" class="">Batch</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/batch/002_batch_performance/" class="">002 Batch Performance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/batch/001_performance_improved_batch/" class="active">001 Performance Improved Batch</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-17728c6c6bedfdb3d8e5f42b88c6a9db" class="toggle"  />
    <label for="section-17728c6c6bedfdb3d8e5f42b88c6a9db" class="flex justify-between">
      <a href="/docs/clean_code/" class="">Clean Code</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/clean_code/001_argument/" class="">001 Argument</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7cc6bc3da96a6c77d5e4cc0966a5e312" class="toggle"  />
    <label for="section-7cc6bc3da96a6c77d5e4cc0966a5e312" class="flex justify-between">
      <a href="/docs/data_structure/" class="">Data Structure</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f63d6cf864a4b2a00c9bc1b7f8921b37" class="toggle"  />
    <label for="section-f63d6cf864a4b2a00c9bc1b7f8921b37" class="flex justify-between">
      <a href="/docs/ddd/" class="">Ddd</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-10d41b0387e5bda7e9958b9b5ece051e" class="toggle"  />
    <label for="section-10d41b0387e5bda7e9958b9b5ece051e" class="flex justify-between">
      <a href="/docs/docker/" class="">Docker</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ba0b1465c1bad5a998860ad5f870bf7e" class="toggle"  />
    <label for="section-ba0b1465c1bad5a998860ad5f870bf7e" class="flex justify-between">
      <a href="/docs/etc/" class="">Etc</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/etc/005_rabbit_mq/" class="">005 Rabbit Mq</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/etc/004_sonar_qube/" class="">004 Sonar Qube</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/etc/003_huge_traffic_handling/" class="">003 Huge Traffic Handling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/etc/002_tps/" class="">002 Tps</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/etc/001_jmeter/" class="">001 Jmeter</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-eca69da21de5b0cd25d8421dec09a327" class="toggle"  />
    <label for="section-eca69da21de5b0cd25d8421dec09a327" class="flex justify-between">
      <a href="/docs/java/" class="">Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/java/001_facade_pattern/" class="">001 Facade Pattern</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f3c1d22d19edbcf158d04b84a4d9d6c2" class="toggle"  />
    <label for="section-f3c1d22d19edbcf158d04b84a4d9d6c2" class="flex justify-between">
      <a href="/docs/jenkins/" class="">Jenkins</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-55218fb7ef47d61aa86fc77253026243" class="toggle"  />
    <label for="section-55218fb7ef47d61aa86fc77253026243" class="flex justify-between">
      <a href="/docs/jpa/" class="">Jpa</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c03dced0c5b16cbce767a51b81ce1077" class="toggle"  />
    <label for="section-c03dced0c5b16cbce767a51b81ce1077" class="flex justify-between">
      <a href="/docs/kafka/" class="">Kafka</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/008_topic_partition/" class="">008 Topic Partition</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/009_record/" class="">009 Record</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/010_metadata/" class="">010 Metadata</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/006_replication/" class="">006 Replication</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/007_isr/" class="">007 Isr</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/004_kafka_broker/" class="">004 Kafka Broker</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/005_broker_log_segment/" class="">005 Broker Log Segment</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/003_transactional_outbox_pattern/" class="">003 Transactional Outbox Pattern</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/002_kafka_intro/" class="">002 Kafka Intro</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kafka/001_kafka_cdc/" class="">001 Kafka Cdc</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-04d541b0249994115320e926dbc9d6c5" class="toggle"  />
    <label for="section-04d541b0249994115320e926dbc9d6c5" class="flex justify-between">
      <a href="/docs/kotlin/" class="">Kotlin</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/005_Kotlin_extractList_Method/" class="">005 Kotlin Extract List Method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/004_Kotlin_Scoping_Functions/" class="">004 Kotlin Scoping Functions</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/003_Kotlin_basic/" class="">003 Kotlin Basic</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/002_Functional_Programming_Example/" class="">002 Functional Programming Example</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/kotlin/001_Functional_Programming/" class="">001 Functional Programming</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6ae1a891fb3a3f71d71273fc61b29b76" class="toggle"  />
    <label for="section-6ae1a891fb3a3f71d71273fc61b29b76" class="flex justify-between">
      <a href="/docs/linux/" class="">Linux</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b16ff4658c272fcaa2c58683b4c10070" class="toggle"  />
    <label for="section-b16ff4658c272fcaa2c58683b4c10070" class="flex justify-between">
      <a href="/docs/mongodb/" class="">Mongodb</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/003_spring_data_mongodb/" class="">003 Spring Data Mongodb</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/004_object_mapping/" class="">004 Object Mapping</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/005_mongoOperations/" class="">005 Mongo Operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/006_reactiveMongoRepository/" class="">006 Reactive Mongo Repository</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/007_query_method/" class="">007 Query Method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/001_reactive_mongodb/" class="">001 Reactive Mongodb</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/mongodb/002_mongodb_document/" class="">002 Mongodb Document</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5e9a5c8a0cadf7504bcc8a3083d0b6fb" class="toggle"  />
    <label for="section-5e9a5c8a0cadf7504bcc8a3083d0b6fb" class="flex justify-between">
      <a href="/docs/msa/" class="">Msa</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/msa/003_circuit_breaker/" class="">003 Circuit Breaker</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/msa/001_reactive/" class="">001 Reactive</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/msa/002_reactive_microservice/" class="">002 Reactive Microservice</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6d933f523f0d56e111956755e38e3f44" class="toggle"  />
    <label for="section-6d933f523f0d56e111956755e38e3f44" class="flex justify-between">
      <a href="/docs/mvc/" class="">Mvc</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-e66e2e478c81786f553bd82d3931b216" class="toggle"  />
    <label for="section-e66e2e478c81786f553bd82d3931b216" class="flex justify-between">
      <a href="/docs/mysql/" class="">Mysql</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3110560962cac834dcd3aead95e804a4" class="toggle"  />
    <label for="section-3110560962cac834dcd3aead95e804a4" class="flex justify-between">
      <a href="/docs/network/" class="">Network</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bbe16af0cda0a52165d4874f0cea4ee0" class="toggle"  />
    <label for="section-bbe16af0cda0a52165d4874f0cea4ee0" class="flex justify-between">
      <a href="/docs/operating_system/" class="">Operating System</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/operating_system/001_thread/" class="">001 Thread</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bf2e8ecdf9011d9f48a2a3a2c2d46bd1" class="toggle"  />
    <label for="section-bf2e8ecdf9011d9f48a2a3a2c2d46bd1" class="flex justify-between">
      <a href="/docs/oracle/" class="">Oracle</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-2aa56d1b653c397446719c79393a70da" class="toggle"  />
    <label for="section-2aa56d1b653c397446719c79393a70da" class="flex justify-between">
      <a href="/docs/parallel_programming/" class="">Parallel Programming</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/035_reentrantLock/" class="">035 Reentrant Lock</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/034_lock_ReentrantLock/" class="">034 Lock Reentrant Lock</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/032_volatile/" class="">032 Volatile</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/033_deadlock/" class="">033 Deadlock</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/031_wait_notify/" class="">031 Wait Notify</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/030_synchronized_etc/" class="">030 Synchronized Etc</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/029_method_synchronized/" class="">029 Method Synchronized</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/027_spin_lock/" class="">027 Spin Lock</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/028_synchronized_basic/" class="">028 Synchronized Basic</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/026_monitor/" class="">026 Monitor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/024_mutual_exclusion/" class="">024 Mutual Exclusion</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/025_semaphore/" class="">025 Semaphore</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/020_single_multi_thread/" class="">020 Single Multi Thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/021_synchronized_cpu/" class="">021 Synchronized CPU</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/022_critical_section/" class="">022 Critical Section</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/023_thread_safe/" class="">023 Thread Safe</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/017_thread_type/" class="">017 Thread Type</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/018_thread_group/" class="">018 Thread Group</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/019_threadLocal/" class="">019 Thread Local</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/012_thread_interrupt/" class="">012 Thread Interrupt</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/013_thread_info/" class="">013 Thread Info</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/014_thread_priority/" class="">014 Thread Priority</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/015_thread_uncaughtExceptionHandler/" class="">015 Thread Uncaught Exception Handler</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/016_thread_stop_flag/" class="">016 Thread Stop Flag</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/011_thread_join/" class="">011 Thread Join</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/010_thread_sleep/" class="">010 Thread Sleep</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/009_thread_status/" class="">009 Thread Status</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/008_thread_start/" class="">008 Thread Start</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/004_cpu_bound_io_bound/" class="">004 CPU Bound Io Bound</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/005_user_kernel_systemcall/" class="">005 User Kernel Systemcall</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/006_user_mode_kernel_mode_thread/" class="">006 User Mode Kernel Mode Thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/007_java_thread/" class="">007 Java Thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/003_context_switching/" class="">003 Context Switching</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/001_process_thread/" class="">001 Process Thread</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/parallel_programming/002_parallel_concurrent/" class="">002 Parallel Concurrent</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-708c7a6270d696606cabeb20f951886f" class="toggle"  />
    <label for="section-708c7a6270d696606cabeb20f951886f" class="flex justify-between">
      <a href="/docs/r2dbc/" class="">R2dbc</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/005_r2dbc_Metadata_mapping/" class="">005 R2dbc Metadata Mapping</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/006_r2dbcEntityOperations/" class="">006 R2dbc Entity Operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/007_r2dbcRepository/" class="">007 R2dbc Repository</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/008_r2dbc_query_method/" class="">008 R2dbc Query Method</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/003_r2dbcEntityTemplate/" class="">003 R2dbc Entity Template</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/004_r2dbc_object_mapping/" class="">004 R2dbc Object Mapping</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/002_r2dbc_mysql/" class="">002 R2dbc Mysql</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/r2dbc/001_r2dbc_intro/" class="">001 R2dbc Intro</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-c1a35f6db1170c97addf30f5d9f50bc9" class="toggle"  />
    <label for="section-c1a35f6db1170c97addf30f5d9f50bc9" class="flex justify-between">
      <a href="/docs/rdbms/" class="">Rdbms</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/rdbms/004_window_function/" class="">004 Window Function</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/rdbms/005_subquery/" class="">005 Subquery</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/rdbms/001_basic_join/" class="">001 Basic Join</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/rdbms/002_date_interval/" class="">002 Date Interval</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/rdbms/003_groupby/" class="">003 Groupby</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a396ef4e072acbb7275e447dad1284d6" class="toggle"  />
    <label for="section-a396ef4e072acbb7275e447dad1284d6" class="flex justify-between">
      <a href="/docs/reactive_streams/" class="">Reactive Streams</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive_streams/002_impl1_reactor/" class="">002 Impl1 Reactor</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive_streams/003_impl2_rxjava/" class="">003 Impl2 Rxjava</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive_streams/004_impl3_munity/" class="">004 Impl3 Munity</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/reactive_streams/001_reactive_streams_component/" class="">001 Reactive Streams Component</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-a27d7ef673b519721b4909eba7547282" class="toggle"  />
    <label for="section-a27d7ef673b519721b4909eba7547282" class="flex justify-between">
      <a href="/docs/redis/" class="">Redis</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/008_spring_session_redis/" class="">008 Spring Session Redis</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/007_redis_cluster_migration/" class="">007 Redis Cluster Migration</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/003_reactive_redis_intro/" class="">003 Reactive Redis Intro</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/004_Lettuce/" class="">004 Lettuce</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/005_ReactiveRedisTemplate/" class="">005 Reactive Redis Template</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/006_ReactiveOperations/" class="">006 Reactive Operations</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/001_redis_datastructure/" class="">001 Redis Datastructure</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/redis/002_redis_cache/" class="">002 Redis Cache</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6ce8ef21c020ccdb7ed73156795b30be" class="toggle"  />
    <label for="section-6ce8ef21c020ccdb7ed73156795b30be" class="flex justify-between">
      <a href="/docs/security/" class="">Security</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-4442d34d5ae489970dcda30dcfc7289e" class="toggle"  />
    <label for="section-4442d34d5ae489970dcda30dcfc7289e" class="flex justify-between">
      <a href="/docs/servlet/" class="">Servlet</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-12bece9beab0746d531536027bb6a777" class="toggle"  />
    <label for="section-12bece9beab0746d531536027bb6a777" class="flex justify-between">
      <a href="/docs/spring/" class="">Spring</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-bc7d9ceb6dc60f10f3ecfb9266f57cb9" class="toggle"  />
    <label for="section-bc7d9ceb6dc60f10f3ecfb9266f57cb9" class="flex justify-between">
      <a href="/docs/springbatch/" class="">Springbatch</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/docs/springbatch/004_JobParameter/" class="">004 Job Parameter</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/springbatch/005_JobExecution/" class="">005 Job Execution</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/springbatch/002_Job/" class="">002 Job</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/springbatch/003_JobInstance/" class="">003 Job Instance</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/docs/springbatch/001_springbatch_start/" class="">001 Springbatch Start</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-5f1e4c3c9f29fee9a25ac2c5291c7472" class="toggle"  />
    <label for="section-5f1e4c3c9f29fee9a25ac2c5291c7472" class="flex justify-between">
      <a href="/docs/webflux/" class="">Webflux</a>
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>











  
<ul>
  
  <li>
    <a href="/posts/"  >
        Categories and tags
      </a>
  </li>
  
  <li>
    <a href="https://github.com/seohaebada"  target="_blank" rel="noopener">
        Github
      </a>
  </li>
  
  <li>
    <a href="https://devfunny.tistory.com"  target="_blank" rel="noopener">
        Blog
      </a>
  </li>
  
</ul>






</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>001 Performance Improved Batch</strong>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#tech-blog-글-읽고-정리하기"><code>tech blog 글 읽고 정리하기</code></a></li>
    <li><a href="#누구나-할-수-있는-10배-더-빠른-배치-만들기">누구나 할 수 있는 10배 더 빠른 배치 만들기</a>
      <ul>
        <li><a href="#우아한형제들-셀러-시스템-배치-개선-이야기">우아한형제들 셀러 시스템 배치 개선 이야기</a></li>
        <li><a href="#비운영-시간-데이터">비운영 시간 데이터</a></li>
        <li><a href="#문제상황">문제상황</a></li>
        <li><a href="#io-최적화">I/O 최적화</a></li>
        <li><a href="#도메인-로직-및-기타-최적화">도메인 로직 및 기타 최적화</a></li>
        <li><a href="#최적화-검토">최적화 검토</a></li>
        <li><a href="#검토해야할-부분">검토해야할 부분</a></li>
        <li><a href="#너무-빨라도-문제">너무 빨라도 문제</a></li>
        <li><a href="#최적화-작업">최적화 작업</a></li>
        <li><a href="#참고">참고</a></li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="tech-blog-글-읽고-정리하기">
  <code>tech blog 글 읽고 정리하기</code>
  <a class="anchor" href="#tech-blog-%ea%b8%80-%ec%9d%bd%ea%b3%a0-%ec%a0%95%eb%a6%ac%ed%95%98%ea%b8%b0">#</a>
</h1>
<h1 id="누구나-할-수-있는-10배-더-빠른-배치-만들기">
  누구나 할 수 있는 10배 더 빠른 배치 만들기
  <a class="anchor" href="#%eb%88%84%ea%b5%ac%eb%82%98-%ed%95%a0-%ec%88%98-%ec%9e%88%eb%8a%94-10%eb%b0%b0-%eb%8d%94-%eb%b9%a0%eb%a5%b8-%eb%b0%b0%ec%b9%98-%eb%a7%8c%eb%93%a4%ea%b8%b0">#</a>
</h1>
<h2 id="우아한형제들-셀러-시스템-배치-개선-이야기">
  우아한형제들 셀러 시스템 배치 개선 이야기
  <a class="anchor" href="#%ec%9a%b0%ec%95%84%ed%95%9c%ed%98%95%ec%a0%9c%eb%93%a4-%ec%85%80%eb%9f%ac-%ec%8b%9c%ec%8a%a4%ed%85%9c-%eb%b0%b0%ec%b9%98-%ea%b0%9c%ec%84%a0-%ec%9d%b4%ec%95%bc%ea%b8%b0">#</a>
</h2>
<p>우아한형제들 기술 블로그의 글을 읽으면서 정리해본다.<br>
최근 셀러시스템팀에서 하루 한 번 주기로 실행되는 배치를 최적화하는 과제를 진행한 내용에 대한 포스팅이다.</p>
<h2 id="비운영-시간-데이터">
  비운영 시간 데이터
  <a class="anchor" href="#%eb%b9%84%ec%9a%b4%ec%98%81-%ec%8b%9c%ea%b0%84-%eb%8d%b0%ec%9d%b4%ed%84%b0">#</a>
</h2>
<ul>
<li>셀러시스템에서는 가게와 업주에 대한 다양한 데이터를 관리</li>
<li>사장님들의 관리 사항

  <img src="/image/batch/001/img.png" alt="img.png" /></li>
<li>&lsquo;가게가 운영하는지 안하는지&rsquo;에 대한 정보를 유관 부서에 전달한다.
<ul>
<li>&lsquo;비운영시간 데이터&rsquo;</li>
<li>실시간으로 수정되는 정보를 반영</li>
<li>매일 새벽에 전체 데이터를 계산하고 그 결과를 미리 갱신해둔 후, 유관부서에 전파</li>
</ul>
</li>
</ul>
<blockquote>
<p>다양한 채널에서 입력되는 각족 운영과 휴무 데이터를 취합해서 비운영시간 데이터를 계산

  <img src="/image/batch/001/img_1.png" alt="img_1.png" /></p>
</blockquote>
<blockquote>
<p>위 계산된 데이터가 클라이언트까지 잘 전달될 수 있도록 각 지면에 적절한 형태로 가공하여 제공

  <img src="/image/batch/001/img_2.png" alt="img_2.png" /></p>
</blockquote>
<h2 id="문제상황">
  문제상황
  <a class="anchor" href="#%eb%ac%b8%ec%a0%9c%ec%83%81%ed%99%a9">#</a>
</h2>
<ul>
<li>새벽에 배치 작업을 할때, 수많은 가게의 데이터를 매일 갱신하므로 배치 수행시간이 오래걸린다.</li>
<li>배포 예정 시간과 배치 실행 시간이 겹칠 경우, 배포가 여러번 복잡한 절차를 밟아 진행해야한다. (잠재적인 리스크)</li>
<li>배치 성능 개선이 필요</li>
</ul>
<h2 id="io-최적화">
  I/O 최적화
  <a class="anchor" href="#io-%ec%b5%9c%ec%a0%81%ed%99%94">#</a>
</h2>
<ul>
<li>I/O 병목을 먼저 살펴본다.</li>
</ul>
<blockquote>
<p>I/O (Input / Output) 병목이란?
컴퓨팅에서 부하를 설명할 때에는 크게 CPU 부하와 I/O 부하로 나뉩니다.
데이터를 계산하고 처리하는 과정인 CPU 부하와 달리, I/O 부하는 디스크에 파일을 읽고 쓰거나 DB 및 외부 컴포넌트와 통신하는 과정에서 발생합니다.
I/O 병목은 이러한 I/O 부하가 시스템의 전체적인 효율성을 떨어뜨리는 부분을 말합니다.</p>
</blockquote>
<ul>
<li>배치에서 사용하는 I/O 부하 중 가장 핵심은 DB 쿼리였다.</li>
<li>원인 : JPA 지연 로딩으로 설정된 연관 관계 엔티티를 가져오는 과정에서 N+1 문제가 발생

  <img src="/image/batch/001/img_3.png" alt="img_3.png" /></li>
<li>데이터가 모두 1:N 구조의 연관관계로 설정되어 있어서 관련 데이터를 가져오는데에 오랜 시간이 걸린다.

  <img src="/image/batch/001/img_4.png" alt="img_4.png" /></li>
</ul>
<blockquote>
<p>해결</p>
</blockquote>
<ul>
<li>연관관계로 설정된 엔티티의 종류가 많고 실제 연관관계 데이터의 수정은 불필요하다는 점 등을 고려하여,</li>
<li>각 엔티티 정보를 연관관계를 통해 가져오는 것이 아닌 별도 쿼리 호출을 통해 명시적으로 한 번에 읽어오게끔 수정</li>
</ul>
<blockquote>
<p>Before</p>
</blockquote>
<pre tabindex="0"><code>public List&lt;LiveShopClose&gt; generateLiveShopClose(Shop shop, LocalDate startDate, LocalDate endDate) {
    final List&lt;ShopCalendar&gt; shopCalendars = shopCalendarRepository.findAllByCalendarDateBetween(startDate, endDate);
    final List&lt;ShopTemporaryClosed&gt; shopTemporaryCloses = shop.getActiveShopTemporaryClosed();
    final List&lt;ShopClosed&gt; shopCloses = shop.getActiveShopClosed();
    final List&lt;ShopOperationHour&gt; operationHours = shop.getShopOperationHourIsType(OperationHourType.OPERATION);

    return /* LiveShopClose 데이터 생성 */
}
</code></pre><blockquote>
<p>After</p>
</blockquote>
<pre tabindex="0"><code>List&lt;LiveShopClose&gt; generateLiveShopCloses(List&lt;Long&gt; shopNos, LocalDate startDate, LocalDate endDate) {
    List&lt;ShopNo&gt; shopNoEntities = shopNos.stream().map(ShopNo::new).collect(Collectors.toList());

    List&lt;ShopCalendar&gt; shopCalendars = shopCalendarRepository.findAllByCalendarDateBetween(startDate, endDate);
    Map&lt;Long, List&lt;ShopTemporaryClosed&gt;&gt; activeShopTemporaryClosedMap =
            shopTemporaryClosedRepository.findActiveByShopNos(shopNoEntities).stream()
                    .collect(groupingBy(ShopTemporaryClosed::getShopNo, Collectors.toList()));
    Map&lt;Long, List&lt;ShopClosed&gt;&gt; activeShopClosedMap =
            shopClosedRepository.findActiveByShopNos(shopNoEntities).stream()
                    .collect(groupingBy(ShopClosed::getShopNo, Collectors.toList()));
    Map&lt;Long, List&lt;ShopOperationHour&gt;&gt; operationHoursMap =
            shopOperationHoursRepository.findOperationHoursByShopNos(shopNoEntities).stream()
                    .collect(groupingBy(ShopOperationHour::getShopNo, Collectors.toList()));

    return shopNos.stream()
            .flatMap(shopNo -&gt; generateLiveShopClose(
                    shopNo,
                    shopCalendars,
                    ListUtils.emptyIfNull(activeShopTemporaryClosedMap.get(shopNo)),
                    ListUtils.emptyIfNull(activeShopClosedMap.get(shopNo)),
                    ListUtils.emptyIfNull(operationHoursMap.get(shopNo))
            ).stream())
            .collect(Collectors.toList());
}

List&lt;LiveShopClose&gt; generateLiveShopClose(Long shopNo, List&lt;ShopCalendar&gt; shopCalendars,
                                          List&lt;ShopTemporaryClosed&gt; activeShopTemporaryCloses,
                                          List&lt;ShopClosed&gt; activeShopCloses,
                                          List&lt;ShopOperationHour&gt; operationHours) {

    return /* LiveShopClose 데이터 생성 */
}
</code></pre><h2 id="도메인-로직-및-기타-최적화">
  도메인 로직 및 기타 최적화
  <a class="anchor" href="#%eb%8f%84%eb%a9%94%ec%9d%b8-%eb%a1%9c%ec%a7%81-%eb%b0%8f-%ea%b8%b0%ed%83%80-%ec%b5%9c%ec%a0%81%ed%99%94">#</a>
</h2>
<p>
  <img src="/image/batch/001/img_5.png" alt="img_5.png" /></p>
<ul>
<li>현재 가게의 비운영시간 데이터가 업데이트될 경우, 변경된 가게에 대한 이벤트를 발행</li>
<li>기존 로직에서는 실제 데이터의 변경 여부와는 관계없이 D-1~D+2 데이터를 무조건 재생성하기 때문에,</li>
<li>실제로는 데이터가 변경되지 않을 테지만 다시 데이터가 생성되어 변경 이벤트가 전송되는 케이스 존재

  <img src="/image/batch/001/img_6.png" alt="img_6.png" /></li>
<li>대응 : 이러한 케이스에 대응하여 데이터가 바뀌었는지 여부를 확인한 후 실제로 바뀐 경우에만 변경 사항을 적용</li>
<li>효과 : 변경 이벤트로 인한 간접적인 부하 개선</li>
</ul>
<h2 id="최적화-검토">
  최적화 검토
  <a class="anchor" href="#%ec%b5%9c%ec%a0%81%ed%99%94-%ea%b2%80%ed%86%a0">#</a>
</h2>
<ol>
<li>성능 효율을 높이기 위해 컴퓨팅 업계에서는 많은 죄악이 저질러지는데(심지어 효율적이지조차 않을 때도 있다) 그 수는 그냥 멍청해서 저지르는 죄악보다 많다.</li>
</ol>
<ul>
<li>William A. Wulf (1972)</li>
</ul>
<ol start="2">
<li>우리는 세세한 성능 효율에 대해서는 무시할 필요가 있다. 말하자면 97%가 이 경우에 해당한다. 섣부른 최적화는 만악의 근원이다.</li>
</ol>
<ul>
<li>Donald E. Knuth (1974)</li>
</ul>
<ol start="3">
<li>우리는 최적화에 대해서 다음 두가지 규칙을 따른다.
첫째. 하지 마라.
둘째. (전문가 한정) 아직은 하지 마라. 최적화되지 않은 상태로도 완벽하게 깔끔한 해결책을 찾는 것이 먼저다.</li>
</ol>
<ul>
<li>M. A. Jackson (1975)</li>
</ul>
<p>효율만 쫒다가 득보다 실이 큰 경우를 경계하라는 뜻</p>
<blockquote>
<p>최적화를 하기 전에 항상 아래 두가지를 검토</p>
</blockquote>
<ol>
<li>
<p>최적화 이전에 먼저 좋은 코드를 작성하기
코드를 작성하는 데 있어서 성능을 염두에 두는 것은 물론 중요합니다.
하지만 많은 경우 대부분의 코드는 성능상 영향이 크지 않고 실제로 병목이 되는 부분은 극히 일부분입니다.
좋은 코드를 최적화하기는 쉽지만, 섣부르게 최적화된 코드를 좋은 코드로 만드는 건 어렵습니다.
빠른 코드보다는 좋은 코드를 짜는 데에 먼저 집중하고 최적화는 그 다음에 생각해야 합니다.</p>
</li>
<li>
<p>정량적으로 성능을 측정하면서 병목을 파악하기
정량화된 지표를 통해 실제로 병목이 되는 부분을 파악해야 합니다.
지엽적인 부분을 일일히 개선하는 마이크로 최적화는 많은 경우 100ms 를 99ms로 줄이는 것에 그칩니다.
마이크로 최적화 보다는 거시적인 관점에서 중요한 병목을 찾고 이를 구조적으로 해결하는 것이 중요합니다.
그리고 실질적으로 얼마나 빨라졌는지 정량적인 성과로 나타낼 수 있어야 합니다.</p>
</li>
</ol>
<h2 id="검토해야할-부분">
  검토해야할 부분
  <a class="anchor" href="#%ea%b2%80%ed%86%a0%ed%95%b4%ec%95%bc%ed%95%a0-%eb%b6%80%eb%b6%84">#</a>
</h2>
<p>위 개선을 통해 배치 수행시간이 너무 빨라졌다.
MSA 구조에서는 애플리케이션과 직접적으로 연동되는 DB와 로드밸런서 뿐만 아니라,
많은 모듈 및 유관부서들이 유기적으로 연결되어있기 때문에 영향 범위를 면밀히 검토해야한다.

  <img src="/image/batch/001/img_7.png" alt="img_7.png" /></p>
<ul>
<li>
<p>데이터 변경이 발생하면 변경 사항이 큐를 통해서 유관 부서에 전달된다.

  <img src="/image/batch/001/img_8.png" alt="img_8.png" /></p>
</li>
<li>
<p>확인 지표</p>
<ul>
<li>개발 환경에서 테스트 당시 애플리케이션이 실행되는 서버의 CPU 및 I/O 지표</li>
<li>개발 환경에서 테스트 당시 DB CPU, 쿼리 지연 시간 등 지표</li>
<li>예상 트래픽을 산출, 현재 운영 환경에서의 피크 트래픽과 비교하여 문제가 없을지 검토</li>
<li>변경 사항을 전달하는 큐에서 지연이 발생해도 문제가 없을지 검토</li>
</ul>
</li>
</ul>
<h2 id="너무-빨라도-문제">
  너무 빨라도 문제
  <a class="anchor" href="#%eb%84%88%eb%ac%b4-%eb%b9%a8%eb%9d%bc%eb%8f%84-%eb%ac%b8%ec%a0%9c">#</a>
</h2>
<ul>
<li>빠르게 동작하기 때문에, 유관 부서 트래픽 또한 예상 이상으로 인입되어 DB CPU가 높아짐</li>
</ul>
<blockquote>
<p>해결방안 : 의도적으로 지연 시간 설정</p>
</blockquote>
<pre tabindex="0"><code>@Bean(STEP_NAME)
@JobScope
public Step liveShopCloseCreateStep() {
    return stepBuilderFactory.get(STEP_NAME)
            .&lt;Long, Long&gt;chunk(CHUNK_SIZE)
            .reader(shopCloseScheduleReader(null))
            .writer(liveShopCloseWriter(null, null, null))
            .transactionManager(storeTransactionManager)
            .listener(new AfterChunkSleepListener(200))
            .build();
}
</code></pre><pre tabindex="0"><code>@Slf4j
public class AfterChunkSleepListener implements ChunkListener {
    private final long sleepMillis;

    public AfterChunkSleepListener(long sleepMillis) {
        this.sleepMillis = sleepMillis;
    }

    @Override
    public void afterChunk(ChunkContext context) {
        try {
            log.info(&#34;Chunk 실행 후 sleep {} millis. 현재 read Count : {}&#34;,
                    sleepMillis,
                    context.getStepContext().getStepExecution().getReadCount());
            TimeUnit.MILLISECONDS.sleep(sleepMillis);
        } catch (InterruptedException e) {
            log.error(&#34;Thread sleep interrupted.&#34;, e);
        }
    }

    @Override
    public void afterChunkError(ChunkContext context) {
        // 사용안함.
    }

    @Override
    public void beforeChunk(ChunkContext context) {
        // 사용안함.
    }
}
</code></pre><ul>
<li>지연 시간을 설정해도 배치는 390분 -&gt; 30분 소요되는 결과를 얻음

  <img src="/image/batch/001/img_9.png" alt="img_9.png" /></li>
</ul>
<h2 id="최적화-작업">
  최적화 작업
  <a class="anchor" href="#%ec%b5%9c%ec%a0%81%ed%99%94-%ec%9e%91%ec%97%85">#</a>
</h2>
<ul>
<li>리스크를 확인하고 과제에 대한 우선순위를 조정하기</li>
<li>문제 상황을 분석하고 병목을 확인하기</li>
<li>I/O의 경우 최대한 한번에 여러건을 읽고 쓰도록 하여 효율성 높이기</li>
<li>도메인 로직을 검토하여 개선할 수 있는 부분이 있는지 살피기</li>
<li>유의미한 최적화인가? 정량적인 지표로 다시 검토하기</li>
<li>빨라도 문제일 수 있으니 최적화에 의한 영향 범위를 검토하고 운영 환경에서도 문제가 없을지 확인하기</li>
</ul>
<h2 id="참고">
  참고
  <a class="anchor" href="#%ec%b0%b8%ea%b3%a0">#</a>
</h2>
<ul>
<li>위 배치의 chunk size : 100으로 설정</li>
</ul>
<hr>




<div class="book-tabs"><input type="radio" class="toggle" name="tabs-References" id="tabs-References-0" checked="checked" />
  <label for="tabs-References-0">References</label>
  <div class="book-tabs-content markdown-inner"><ol>
<li>
  <a href="https://techblog.woowahan.com/13569/?ref=codenary">https://techblog.woowahan.com/13569/?ref=codenary</a></li>
<li>
  <a href="https://www.codenary.co.kr/search?keyword=Java">https://www.codenary.co.kr/search?keyword=Java</a></li>
</ol>
</div></div>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/seohaebada/TIL/commit/ff4648f30378a38fee9f3522f0f76ef601a4a5f1" title='Last modified by seohaebada | December 27, 2023' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="Calendar" />
      <span>December 27, 2023</span>
    </a>
  </div>



  <div>
    <a class="flex align-center" href="https://github.com/seohaebada/TIL/content/docs/content/docs/batch/001_performance_improved_batch.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>


</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#tech-blog-글-읽고-정리하기"><code>tech blog 글 읽고 정리하기</code></a></li>
    <li><a href="#누구나-할-수-있는-10배-더-빠른-배치-만들기">누구나 할 수 있는 10배 더 빠른 배치 만들기</a>
      <ul>
        <li><a href="#우아한형제들-셀러-시스템-배치-개선-이야기">우아한형제들 셀러 시스템 배치 개선 이야기</a></li>
        <li><a href="#비운영-시간-데이터">비운영 시간 데이터</a></li>
        <li><a href="#문제상황">문제상황</a></li>
        <li><a href="#io-최적화">I/O 최적화</a></li>
        <li><a href="#도메인-로직-및-기타-최적화">도메인 로직 및 기타 최적화</a></li>
        <li><a href="#최적화-검토">최적화 검토</a></li>
        <li><a href="#검토해야할-부분">검토해야할 부분</a></li>
        <li><a href="#너무-빨라도-문제">너무 빨라도 문제</a></li>
        <li><a href="#최적화-작업">최적화 작업</a></li>
        <li><a href="#참고">참고</a></li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












